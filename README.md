# Note.com 検索結果エクスポーター

note.com の検索結果ページから記事情報を取得し、CSV 形式でエクスポートする Chrome 拡張機能です。

## 概要

[note.com](https://note.com) の検索結果一覧から、タイトル・スキ数・高評価数・単価・記事URL・クリエイター名などを収集し、1 つの CSV ファイルとしてダウンロードできます。調査や分析の用途にご利用ください。

## 主な機能

- **検索結果の一括取得**  
  指定した件数（1〜500 件）まで、検索結果から記事情報を取得します。
- **2 段階の取得戦略**
  1. **API 経由**: note.com の内部検索 API から JSON で取得（高速・安定）
  2. **DOM スクレイピング**: API が使えない場合、ページを自動スクロールしながら DOM から取得
- **高評価数の取得**  
  各記事ページ（または API）から「高評価数」を取得し、CSV に含めます。
- **CSV エクスポート**  
  UTF-8（BOM 付き）の CSV をダウンロード。Excel などでそのまま開けます。

## エクスポートされるデータ（CSV の列）

| 列名       | 説明                         |
|------------|------------------------------|
| タイトル   | 記事のタイトル               |
| スキ数     | 記事の「スキ」の数           |
| 高評価数   | 記事の「高評価」の数         |
| 単価       | 有料記事の場合は価格（円）   |
| 記事URL    | 記事の URL                   |
| クリエイター名 | 記事を書いたユーザー名   |

## 必要な環境

- **Google Chrome**（Manifest V3 対応のブラウザ）
- note.com にアクセスできるネットワーク

## インストール方法

### 開発者モードで読み込む（未パッケージのまま使う場合）

1. このリポジトリをクローンまたは ZIP でダウンロードし、任意のフォルダに展開する。
2. Chrome で `chrome://extensions/` を開く。
3. 右上の **「開発者モード」** をオンにする。
4. **「パッケージ化されていない拡張機能を読み込む」** をクリックし、このプロジェクトの **ルートフォルダ**（`manifest.json` があるフォルダ）を選択する。
5. 拡張機能一覧に「Note.com 検索結果エクスポーター」が表示されればインストール完了です。

### アイコンについて

`manifest.json` では `icons/icon16.png`, `icons/icon48.png`, `icons/icon128.png` を参照しています。これらのファイルが無い場合は、アイコン用の画像を用意するか、manifest の `icons` / `action.default_icon` を削除または編集してください。

## 使い方

1. Chrome で **note.com の検索結果ページ**を開く。  
   （例: `https://note.com/search?q=キーワード`）
2. ツールバーの拡張機能アイコンをクリックし、ポップアップを開く。
3. **取得件数**（1〜500）を入力する。
4. **「データ取得開始」** をクリックする。
5. 処理が終わると、CSV ファイルが自動でダウンロードされます。  
   ファイル名は `note_search_results_YYYYMMDD_HHMM.csv` の形式です。

※ 取得件数が多い場合や、高評価数を 1 記事ずつ取得するため、完了まで数分かかることがあります。

## プロジェクト構成

```
.
├── manifest.json       # Chrome 拡張機能のマニフェスト（Manifest V3）
├── popup.html          # 拡張機能アイコンクリックで開くポップアップ
├── popup.js            # ポップアップの処理（取得件数入力・開始・進捗表示）
├── content_script.js   # 検索結果ページに注入するスクリプト（取得・CSV 生成の本体）
├── styles.css          # Content Script 用スタイル（オーバーレイ表示など）
├── icons/              # 拡張機能アイコン（16 / 48 / 128px）
├── package.json        # 開発用（テスト実行など）
├── content_script.test.js  # content_script.js のユニット/結合テスト
└── README.md           # 本ファイル
```

## 開発・テスト

- **テストの実行**  
  `npm test` で Jest によるテストを実行できます。  
  `content_script.js` の主要なユーティリティ関数（数値抽出、URL 解析、API レスポンス解析、CSV エスケープなど）がテスト対象です。

```bash
npm install
npm test
```

## 技術的な補足

- **Content Script** は `https://note.com/search*` にのみ注入されます。
- 取得フローは次のとおりです。
  1. まず `note.com` の検索 API（`/api/v3/searches`）で指定件数までページネーションしながら取得を試行。
  2. API が使えない、または結果が空の場合は、ページを自動スクロールしながら DOM から記事リンク・タイトル・スキ数・価格・クリエイター名を収集。
  3. 取得した記事について、記事詳細 API または HTML から「高評価数」を取得。
  4. 全データを CSV にまとめ、ダウンロード用のリンクで保存。

## 注意事項・免責事項

- この拡張機能は、note.com の利用規約および robots.txt 等のポリシーに従ってご利用ください。
- 取得頻度が高すぎると、サービス側で制限やブロックされる可能性があります。必要以上に大量・連続で実行しないようご注意ください。
- 本ソフトウェアの利用により生じた損害等について、作者は一切の責任を負いません。

## ライセンス

ISC（`package.json` の記載に準拠）
